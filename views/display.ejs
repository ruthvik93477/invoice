
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Display</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="icon" href="logo.jpeg" style="border-radius: 25px;">
  <style>
    .btn{
      width: 80px;
    }
  </style>
</head>
<body>
  <h1 class="text-center"><i>Invoice Details</i></h1>
  <% data.forEach(entry => { %>
    <div id="<%= entry._id %>" >
        <div class="row mx-3 my-3">
          <div class="col">
            <div class="card">
              <div class="card-header">
                <ul class="nav nav-pills card-header-pills">
                  <li class="nav-item">
                    <a class="nav-link active bg-info mx-2 my-2" href="/landing"><b><i>Home</i></b></a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active bg-warning mx-2 my-2" href="/kpmgUpload"><b><i>KPMG</i></b></a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active mx-2 my-2 bg-success" href="/atkFormUpload"><b><i>AITEK INDIA</i></b></a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active bg-dark mx-2 my-2" href="/rzUpload" tabindex="-1" aria-disabled="true"><b><i>Rizing</i></b></a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active bg-danger mx-2 my-2" href="/form3upload" tabindex="-1" aria-disabled="true"><b><i>SEA Opns</i></b></a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active bg-secondary mx-2 my-2" href="/atkFormUpload" tabindex="-1" aria-disabled="true"><b><i>Radient</i></b></a>
                  </li>
                </ul>
              </div>
              <div class="card-body">
                <h4 class="card-title"><b><i>Invoice Number: </i></b><%= entry.invoiceNumberf %></h5>
                <p class="card-text"><b><i>Party Name: </i></b><%= entry.pn %></p>
                <p class="card-text"><b><i>Company Name: </i></b><%= entry.companyName %></p>
                <p class="card-text"><b><i>Status: </i></b><%= entry.status %></p>
                <p class="card-text"><b><i>Remarks: </i></b><%= entry.remarks %></p>
                <a><button onclick="enableEdit('<%= entry._id %>')" class="btn btn-primary"><b><i>Edit</i></b></button></a>
              </div>
            </div>
          </div>
        </div>
      <div class="card mx-4 my-4">
        <div class="mx-3 my-3">
          <form id="form-<%= entry._id %>" onsubmit="save('<%= entry._id %>'); return false;" style="display:none;">
            <label for="invoiceNumberf-"><b><i>Invoice Number: </i></b></label>
            <input type="text" id="invoiceNumberf-<%= entry._id %>" value="<%= entry.invoiceNumberf %>" required class="form-control">
            <br>
            <label for="pn-"><b><i>Party Name: </i></b></label>
            <input type="text" id="pn-<%= entry._id %>" value="<%= entry.pn %>" class="form-control" required>
            <br>
            <label for="companyName-"><b><i>Company Name: </i></b></label>
            <input type="text" id="companyName-<%= entry._id %>" value="<%= entry.companyName %>" class="form-control" required>
            <br>
            <label for="status-"><b><i>Status: </i></b></label>
            <input type="text" id="status-<%= entry._id %>" value="<%= entry.status %>" class="form-control" required>
            <br>
            <label for="remarks-"><b><i>Remarks: </i></b></label>
            <input type="text" id="remarks-<%= entry._id %>" value="<%= entry.remarks %>" class="form-control" required>
            <br>
            <button type="submit" class="btn btn-success"><b><i>Save</i></b></button>
          </form>
        </div>
      </div>
    </div>
  <% }) %>

  <script>
    function enableEdit(id) {
      const entryDiv = document.getElementById(id);
      const editButton = entryDiv.querySelector('button');
      const form = document.getElementById('form-' + id);

      editButton.style.display = 'none';
      form.style.display = 'block';
    }

    async function save(id) {
      const newInvoiceNumber = document.getElementById('invoiceNumberf-' + id).value;
      const newPartyName = document.getElementById('pn-' + id).value;
      const newStatus = document.getElementById('status-' + id).value;
      const newCompanyName = document.getElementById('companyName-'+id).value;
      const newRemarks = document.getElementById('remarks-'+id).value;

      const response = await fetch(`/update/${id}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          invoiceNumberf: newInvoiceNumber,
          pn: newPartyName,
          companyName: newCompanyName,
          status: newStatus,
          remarks: newRemarks,
        }),
      });
      window.location.reload();
      /*if (response) {
        const entryDiv = document.getElementById(id);
        entryDiv.querySelector('h4').innerText = newInvoiceNumber;
        entryDiv.querySelector('p:nth-child(2)').innerText = 'Party Name: ' + newPartyName;
        entryDiv.querySelector('p:nth-child(3)').innerText = 'Company Name: ' + newCompanyName;
        entryDiv.querySelector('p:nth-child(4)').innerText = 'Status: ' + newStatus;
        entryDiv.querySelector('p:nth-child(5)').innerText = 'Remarks: ' + newRemarks;

        // Re-enable the Edit button after saving
        const editButton = entryDiv.querySelector('button');
        const form = document.getElementById('form-' + id);

        editButton.style.display = 'inline';
        form.style.display = 'none';
      } else {
        alert('Failed to update data');
      }*/
    }
  </script>
</body>
</html>
